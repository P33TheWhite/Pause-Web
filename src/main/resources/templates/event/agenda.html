<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout :: layout(~{::main}, ~{})}">

    <main>
        <div class="container mt-5 mb-4">
            <h1 style="color: var(--couleur-asso-bg); font-weight: bold;">L'Agenda de La Pau'se</h1>
            <p class="lead">Ne ratez aucun croque-monsieur ni aucune soirÃ©e !</p>
            <hr>

            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
        </div>

        <div class="container mb-5">
            <div class="row row-cols-1 row-cols-md-3 g-4">

                <div class="col" th:each="event : ${events}">
                    <div class="card h-100 shadow-sm border-0">

                        <div
                            style="height: 200px; background-color: #eee; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img th:if="${!event.photos.isEmpty()}" th:src="${event.photos[0].url}" class="card-img-top"
                                alt="Event photo" style="object-fit: cover; height: 100%; width: 100%;">
                            <span th:if="${event.photos.isEmpty()}" style="font-size: 3rem;">ðŸŽ‰</span>
                        </div>

                        <div class="card-body">
                            <div class="mb-2">
                                <span th:each="type : ${event.types}"
                                    class="badge rounded-pill bg-warning text-dark me-1"
                                    th:text="${type.libelle}">Type</span>
                            </div>
                            <h5 class="card-title fw-bold" th:text="${event.titre}">Titre Event</h5>
                            <p class="card-text text-muted">
                                <span th:text="${#temporals.format(event.date, 'dd MMMM yyyy')}">Date</span>
                                <span th:if="${event.heureDebut != null}"
                                    th:text="' ' + ${#temporals.format(event.heureDebut, 'HH''h''mm')}"></span>
                                <span th:if="${event.heureFin != null}"
                                    th:text="'-' + ${#temporals.format(event.heureFin, 'HH''h''mm')}"></span>
                            </p>
                            <p class="card-text" th:text="${event.description}">Description...</p>
                        </div>

                        <div class="card-footer bg-white border-0 pt-0 pb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div th:if="${session.user != null}">
                                    <span class="badge bg-light text-dark border" th:if="${session.user.estCotisant}">
                                        Prix Cotisant : <span class="fw-bold"
                                            th:text="${event.prixCotisant} + ' â‚¬'"></span>
                                    </span>
                                    <span class="badge bg-light text-dark border" th:if="${!session.user.estCotisant}">
                                        Prix Non-Cotisant : <span class="fw-bold"
                                            th:text="${event.prixNonCotisant} + ' â‚¬'"></span>
                                    </span>
                                </div>
                                <div th:if="${session.user == null}">
                                    <small class="text-muted">
                                        <span class="fw-bold" th:text="${event.prixCotisant} + 'â‚¬'"></span> (Cotisant) /
                                        <span class="fw-bold" th:text="${event.prixNonCotisant} + 'â‚¬'"></span> (Non)
                                    </small>
                                </div>
                            </div>

                            <div class="d-grid gap-2" th:if="${session.user != null}">

                                <div th:if="${userStatus.get(event.id) == 'REGISTERED'}" class="d-flex gap-2">
                                    <button
                                        class="btn btn-success flex-grow-1 d-flex align-items-center justify-content-center gap-2"
                                        disabled>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                            <path
                                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                        </svg>
                                        Inscrit
                                    </button>

                                    <a th:if="${event.lienPaiement != null && !event.lienPaiement.isEmpty()}"
                                        th:href="${event.lienPaiement}" target="_blank"
                                        class="btn btn-outline-primary d-flex align-items-center gap-2"
                                        title="Payer en ligne">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-credit-card-fill" viewBox="0 0 16 16">
                                            <path
                                                d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1H0V4zm0 3v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7H0zm3 2h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1z" />
                                        </svg>
                                        Payer
                                    </a>

                                    <form th:action="@{/event/{id}/unregister(id=${event.id})}" method="post">
                                        <button type="submit"
                                            class="btn btn-outline-danger d-flex align-items-center justify-content-center"
                                            title="Se dÃ©sinscrire"
                                            onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir vous dÃ©sinscrire ?')">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                                            </svg>
                                        </button>
                                    </form>
                                </div>


                                <div th:if="${userStatus.get(event.id) == 'WAITING'}" class="d-flex gap-2">
                                    <button
                                        class="btn btn-warning text-dark flex-grow-1 d-flex align-items-center justify-content-center gap-2"
                                        disabled>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-hourglass-split" viewBox="0 0 16 16">
                                            <path
                                                d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1h-11zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2h-7zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48V8.35zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z" />
                                        </svg>
                                        En attente
                                    </button>
                                    <form th:action="@{/event/{id}/unregister(id=${event.id})}" method="post">
                                        <button type="submit"
                                            class="btn btn-outline-danger d-flex align-items-center justify-content-center"
                                            title="Quitter la file"
                                            onclick="return confirm('Quitter la file d\'attente ?')">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                                            </svg>
                                        </button>
                                    </form>
                                </div>


                                <div th:if="${userStatus.get(event.id) == 'NONE'}">
                                    <form th:action="@{/event/{id}/register(id=${event.id})}" method="post">
                                        <button type="submit"
                                            class="btn btn-asso w-100 d-flex align-items-center justify-content-center gap-2"
                                            th:if="${placesRestantes.get(event.id) > 0}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" class="bi bi-ticket-perforated-fill"
                                                viewBox="0 0 16 16">
                                                <path
                                                    d="M0 4.5A1.5 1.5 0 0 1 1.5 3h13A1.5 1.5 0 0 1 16 4.5V6a.5.5 0 0 1-.5.5 1.5 1.5 0 0 0 0 3 .5.5 0 0 1 .5.5v1.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 11.5V10a.5.5 0 0 1 .5-.5 1.5 1.5 0 1 0 0-3A.5.5 0 0 1 0 6V4.5Zm4-1v1h1v-1H4Zm1 3v-1H4v1h1Zm7 0v-1h-1v1h1Zm-1-2h1v-1h-1v1Zm-6 3H4v1h1v-1Zm7 1v-1h-1v1h1Zm-7 1H4v1h1v-1Zm7 1v-1h-1v1Zm-8 1v1h1v-1H4Zm7 1h1v-1h-1v1Z" />
                                            </svg>
                                            S'inscrire
                                            <span class="ms-1 small opacity-75"
                                                th:if="${placesRestantes.get(event.id) != 2147483647}"
                                                th:text="'(' + ${placesRestantes.get(event.id)} + ' places)'"></span>
                                        </button>

                                        <button type="submit"
                                            class="btn btn-warning w-100 d-flex align-items-center justify-content-center gap-2"
                                            th:if="${placesRestantes.get(event.id) == 0}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                                                <path
                                                    d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.79-.615c.27.314.51.65.717 1.006l-.854.405zm.653 2.083c.094.376.158.763.188 1.156l.994-.106a8.04 8.04 0 0 1-.235 1.458l-.947-.326a6.99 6.99 0 0 0-.03-.225l.03-.957zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zm0 1A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm3.5-7a.5.5 0 0 0-.5.5v2.5a.5.5 0 0 0 .5.5h2.5a.5.5 0 0 0 .5-.5v-2.5a.5.5 0 0 0-.5-.5h-2.5z" />
                                            </svg>
                                            Rejoindre la file d'attente
                                        </button>
                                    </form>
                                </div>
                            </div>

                            <div th:if="${session.user == null}" class="d-grid">
                                <a href="/login"
                                    class="btn btn-outline-asso d-flex align-items-center justify-content-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z" />
                                        <path fill-rule="evenodd"
                                            d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
                                    </svg>
                                    Se connecter pour s'inscrire
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 text-center" th:if="${events.isEmpty()}">
                    <div class="alert alert-info">Aucun Ã©vÃ©nement prÃ©vu pour le moment. Revenez vite !</div>
                </div>

            </div>
        </div>
    </main>

</th:block>

</html>