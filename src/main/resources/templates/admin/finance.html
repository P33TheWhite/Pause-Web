<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout :: layout(~{::main})}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <main class="container mt-4">
        <h1>Tableau de Bord Financier</h1>

        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card shadow border-success">
                    <div class="card-body text-center">
                        <h5 class="card-title text-success">Total Récolté</h5>
                        <h2 th:text="${globalStats.totalRecolte} + ' €'">0 €</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow border-danger">
                    <div class="card-body text-center">
                        <h5 class="card-title text-danger">Total Dépenses</h5>
                        <h2 th:text="${globalStats.totalDepenses} + ' €'">0 €</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow border-primary">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">Bénéfice Net</h5>
                        <h2 th:text="${globalStats.benefice} + ' €'">0 €</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow border-warning">
                    <div class="card-body text-center">
                        <h5 class="card-title text-warning">Manque à Gagner</h5>
                        <h2 th:text="${globalStats.totalManquant} + ' €'">0 €</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header bg-dark text-white">
                <h5>Analyse Financière par Événement</h5>
            </div>
            <div class="card-body">
                <canvas id="financeChart" width="400" height="200"></canvas>
            </div>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var labels = /*[[${chartLabels}]]*/[];
            var dataRecolte = /*[[${chartRecolte}]]*/[];
            var dataDepenses = /*[[${chartDepenses}]]*/[];
            var dataBenefice = /*[[${chartBenefice}]]*/[];

            var ctx = document.getElementById('financeChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Récolté (€)',
                            data: dataRecolte,
                            backgroundColor: 'rgba(40, 167, 69, 0.7)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Dépenses (€)',
                            data: dataDepenses,
                            backgroundColor: 'rgba(220, 53, 69, 0.7)',
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Bénéfice (€)',
                            data: dataBenefice,
                            backgroundColor: 'rgba(0, 123, 255, 0.7)',
                            borderColor: 'rgba(0, 123, 255, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            /*]]>*/
        </script>
    </main>
</th:block>

</html>