<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout :: layout(~{::main})}">
<main class="container mt-4">
    <h1>Bureau - Administration</h1>
    
    <div class="row">
        <div class="col-md-5">
            <div class="card shadow mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5>Demandes de Cotisation</h5>
                </div>
                <div class="card-body">
                    <div th:if="${demandes.isEmpty()}" class="text-muted">Aucune demande en attente.</div>
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center" th:each="user : ${demandes}">
                            <div>
                                <strong th:text="${user.nom} + ' ' + ${user.prenom}"></strong><br>
                                <small th:text="'Classe : ' + ${user.classe}"></small>
                            </div>
                            <div>
                                <form style="display:inline;" method="post" th:action="@{/admin/cotisation/{id}/accepter(id=${user.id})}">
                                    <button class="btn btn-success btn-sm">‚úî</button>
                                </form>
                                <form style="display:inline;" method="post" th:action="@{/admin/cotisation/{id}/refuser(id=${user.id})}">
                                    <button class="btn btn-danger btn-sm">‚úò</button>
                                </form>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card shadow">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5>Gestion des √âv√©nements</h5>
                    <a href="/admin/event/new" class="btn btn-light btn-sm">+ Cr√©er</a>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>√âv√©nement</th>
                                <th>Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="evt : ${evenements}">
                                <td th:text="${evt.titre}"></td>
                                <td th:text="${evt.dateEvenement}"></td>
                                <td>
                                    <a th:href="@{/admin/event/{id}(id=${evt.id})}" class="btn btn-sm btn-info text-white">
                                        G√©rer les inscrits
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-dark text-white">
                    <h5>Annuaire des Membres</h5>
                </div>
                <div class="card-body">
                    
                    <div class="input-group mb-3">
                        <span class="input-group-text">üîç</span>
                        <input type="text" id="searchUser" class="form-control" placeholder="Rechercher un membre par nom, pr√©nom ou classe..." onkeyup="filtrerMembres()">
                    </div>

                    <table class="table table-striped table-hover" id="tableMembres">
                        <thead class="table-light">
                            <tr>
                                <th>Nom Pr√©nom</th>
                                <th>Email</th>
                                <th>Classe</th>
                                <th>Statut</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="u : ${tousLesUsers}">
                                <td class="user-info" th:text="${u.nom} + ' ' + ${u.prenom}"></td>
                                <td th:text="${u.email}"></td>
                                <td class="user-classe" th:text="${u.classe}"></td>
                                
                                <td>
                                    <span th:if="${u.estCotisant}" class="badge bg-success">Cotisant ‚úÖ</span>
                                    <span th:if="${!u.estCotisant}" class="badge bg-secondary">Non Cotisant</span>
                                    <span th:if="${u.demandeCotisationEnCours}" class="badge bg-warning text-dark">Demande en cours</span>
                                </td>

                                <td>
                                    <form th:if="${u.id != session.user.id}" method="post" th:action="@{/admin/user/{id}/toggle-cotisant(id=${u.id})}">
                                        <button th:if="${u.estCotisant}" class="btn btn-sm btn-outline-danger" title="Retirer la cotisation">
                                            Retirer les droits
                                        </button>
                                        <button th:if="${!u.estCotisant}" class="btn btn-sm btn-outline-success" title="Passer cotisant">
                                            Passer Cotisant
                                        </button>
                                    </form>
                                    <span th:if="${u.id == session.user.id}" class="text-muted text-small">C'est vous</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function filtrerMembres() {
            let input = document.getElementById("searchUser").value.toLowerCase();
            let rows = document.querySelectorAll("#tableMembres tbody tr");

            rows.forEach(row => {
                let info = row.querySelector(".user-info").innerText.toLowerCase();
                let classe = row.querySelector(".user-classe").innerText.toLowerCase();

                if (info.includes(input) || classe.includes(input)) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }
    </script>
</main>
</th:block>
</html>